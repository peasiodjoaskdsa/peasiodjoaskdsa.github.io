<!-- Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT License. -->
<!DOCTYPE html>
<html>

<head>
    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
</head>

<body>
    <p>This add-in will insert the text 'Hello world!' in a new message.</p>
    <button id="helloButton">Say hello</button>

    <!-- The following image URL tracks diagnostic data for this sample add-in. Please remove the image tag if you reuse this sample in your own code project. -->
    <img src="https://pnptelemetry.azurewebsites.net/pnp-officeaddins/samples/outlook-add-in-hello-world-run" />
</body>

<script>
  Office.onReady((info) => {
    if (info.host === Office.HostType.Outlook) {
      document.getElementById("helloButton").onclick = correctText;
    }
  });

  /**
   * Makes an API call to ChatGPT to correct the text and updates the email body with the corrected version.
   */
  function correctText() {
    // Replace 'YOUR_CHATGPT_API_KEY' with your actual ChatGPT API key
    const apiKey = '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';
    const emailText = "Hello world!"; // Replace this with the text from the email you want to correct

    // Make an API call to ChatGPT to get the corrected text
    fetch('https://api.openai.com/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${apiKey}`,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        model: 'gpt-3.5-turbo',
        messages: [{ role: 'user', content: emailText }],
      }),
    })
      .then((response) => response.json())
      .then((data) => {
        // Extract the corrected text from the API response
        const correctedText = data.choices[0].message.content;

        // Update the email body with the corrected text
        Office.context.mailbox.item.body.setAsync(
          correctedText,
          {
            coercionType: 'html', // Write text as HTML
          },
          // Callback method to check that setAsync succeeded
          function (asyncResult) {
            if (asyncResult.status == Office.AsyncResultStatus.Failed) {
              write(asyncResult.error.message);
            }
          }
        );
      })
      .catch((error) => {
        console.error('Error:', error);
      });
  }
</script>


</html>